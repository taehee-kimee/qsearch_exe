# 검색 성능 최적화 가이드

## 1. 현재 검색 구조

```
앱 실행
    ↓
카테고리 선택 (garosero, kkong, ollaolla, ox_xo 중 택1)
    ↓
선택한 CSV만 메모리에 로드
    ↓
해당 데이터 내에서만 검색
```

## 2. 데이터 현황

| 파일 | 항목 수 | 크기 |
|------|---------|------|
| garosero.csv | 24,068 | 1.5MB |
| kkong.csv | 12,836 | 1.5MB |
| ollaolla.csv | 22,316 | 2.1MB |
| ox_xo.csv | 23,584 | 2.7MB |
| **총합** | **82,804** | **7.8MB** |

## 3. 적용된 최적화

### 3.1 중복 제거 (2024)
- kkong.csv: 8줄 제거
- ollaolla.csv: 20줄 제거
- ox_xo.csv: 74줄 제거
- **총 102줄 중복 제거**

### 3.2 카테고리 선택 최적화
- backup 폴더가 카테고리 목록에 표시되지 않도록 수정
- `SearchOption.AllDirectories` → `SearchOption.TopDirectoryOnly`

## 4. 코드 변경 없이 가능한 최적화

### 4.1 CSV 데이터 최적화
- 필요한 카테고리만 사용 (항목 수가 적을수록 빠름)
- 불필요한 공백, 특수문자 정리

### 4.2 시스템 환경 개선
| 방법 | 효과 |
|------|------|
| SSD 사용 | CSV 로드 및 로깅 속도 향상 |
| RAM 충분히 확보 | 대용량 CSV 처리 시 스왑 방지 |
| 백그라운드 앱 정리 | CPU 리소스 확보 |

### 4.3 캡처 영역 최소화
- 캡처하는 윈도우 크기가 작을수록 OCR 처리가 빠름
- 불필요한 UI 요소가 적을수록 매칭 정확도 향상

## 5. 성능 병목 분석

### 5.1 현재 처리 시간 (프레임당)
| 작업 | 예상 시간 |
|------|----------|
| 이미지 전처리 | ~1초 |
| 전체 DB Fuzzy 매칭 | ~3초 (가장 큰 병목) |
| 기타 처리 | ~1-2초 |
| **총합** | **5-9초** |

### 5.2 주요 병목 원인
1. **매 프레임마다 전체 DB 스캔** - O(N) 시간복잡도
2. **정규식 컴파일 반복** - 매칭 시마다 정규식 재컴파일
3. **이미지 2배 확대 처리** - 픽셀 연산 비용
4. **텍스트 정규화 반복** - 각 항목마다 여러 번 호출

## 6. 추가 코드 최적화 (미적용)

근본적인 속도 개선이 필요한 경우:

### 6.1 인덱싱/해시 기반 검색
- 키워드 인덱스 구축으로 O(N) → O(1) 가능
- 예상 개선: 50-70%

### 6.2 정규식 사전 컴파일
```csharp
private static readonly Regex _pattern = new Regex(@"...", RegexOptions.Compiled);
```
- 예상 개선: 5-10%

### 6.3 캐싱 도입
- 동일 텍스트 재검색 방지
- LRU 캐시로 최근 결과 저장

### 6.4 이미지 전처리 최적화
- 2배 확대 대신 적절한 배율 사용
- 예상 개선: 30-40%

## 7. 관련 파일

| 파일 | 역할 |
|------|------|
| `CsvDataService.cs` | 핵심 검색 알고리즘 |
| `OcrService.cs` | OCR 텍스트 인식 |
| `MainWindow.xaml.cs` | UI 및 스캔 루프 |
| `WindowCaptureService.cs` | 윈도우 캡처 |

## 8. 백업

CSV 원본 백업 위치: `data/backup/`
